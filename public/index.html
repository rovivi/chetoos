<!DOCTYPE html>
<html lang="en-us">

<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>¡Ayuda a chester a salvar al mundo poffs!</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      background-color: #000;
    }

    #fullscreen-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1002;
      padding: 10px 20px;
      font-size: 16px;
      cursor: pointer;
      background-color: #CCCC;
      /* Rojo de YouTube */
      color: white;
      /* Texto blanco */
      border: none;
      /* Sin borde */
      border-radius: 2px;
      /* Bordes ligeramente redondeados */
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
      /* Sombra suave */
      transition: background-color 0.3s;
      /* Transición suave del color de fondo */
    }

    #fullscreen-btn:hover {
      background-color: #DDD;
      /* Rojo oscuro al pasar el mouse */
    }

    #portrait-image {
      display: block;
      /* Ocultar la imagen inicialmente */
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: url('tuto1.webp') no-repeat center center;
      background-size: cover;
      z-index: 1001;
      /* Asegúrate de que está encima de otros elementos */
    }

    #loading-bar {
      width: 960px;
      height: 600px;
      position: absolute;
      left: 50%;
      background-color: #000;
      transform: translateX(-50%);
      z-index: 1000;
      display: flex;
      /* Usa flexbox para centrar el contenido */
      justify-content: center;
      /* Centra horizontalmente */
      align-items: center;
      /* Centra verticalmente */
    }

    #loading-bar-inner {
      height: 80px;
      /* Ajusta la altura según la altura de la imagen y el texto */
      width: 100%;
      /* Ocupa todo el ancho del contenedor padre */
      transition: width 0.5s linear;
      display: flex;
      justify-content: center;
      /* Centra horizontalmente el contenido */
      align-items: center;
      /* Centra verticalmente el contenido */
      overflow: hidden;
    }

    #loading-bar-inner img {
      height: 60px;
      width: auto;
      /* Mantener la relación de aspecto */
    }


    #loading-text {
      position: absolute;
      top: 40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 40px;
      color: aliceblue;
      z-index: 1000;
      /* Asegúrate de que sea mayor que cualquier otro elemento en la página */
    }

    #unity-canvas {
      position: relative;
      z-index: 1;
      /* Asegura que el canvas tenga un z-index menor */
    }
  </style>

</head>

<body style="text-align: center; padding: 0; border: 0; margin: 0;">
  <div id="portrait-image"></div>
  <div id="loading-bar">
    <div id="loading-bar-inner">
      <img src="loading.webp" alt="Loading">
      <div id="loading-text">0%</div>
    </div>
  </div>
  <button id="fullscreen-btn"
    style="position: fixed; top: 20px; right: 20px; z-index: 1002; padding: 10px 20px; font-size: 16px; cursor: pointer;"><i
      class="fa-solid fa-expand"></i></button>

  <canvas id="unity-canvas" width="960" height="600" tabindex="-1"
    style="width: 960px; height: 600px; background: #CCCCCC"></canvas>

  <script src="Build/macv6.loader.js"></script>
  <script>

    const loadingBarInner = document.getElementById('loading-bar-inner');
    const loadingText = document.getElementById('loading-text');

    let percentage = 0; // Inicializa el porcentaje en 0
    let interval = setInterval(() => {
      if (percentage < 70) {
        progress();
      } else {
        clearInterval(interval); // Detiene el primer intervalo
        interval = setInterval(() => {
          if (percentage == 98) {
            clearInterval(interval); // Detiene este segundo intervalo cuando llegue a 99
            return
          }
          progress();
        }, 600);
      }
    }, 80);

    let progress = () => {
      percentage++;
      loadingBarInner.style.width = percentage * 0.8 + "%";
      loadingText.textContent = percentage + "%";
    }

    // Sobrescritura de console.log para interceptar el mensaje "loading!"
    let originalConsoleLog = console.log;
    console.log = function (message) {
      originalConsoleLog(message);
      if (message.includes("loading!")) {
        clearInterval(interval);
        loadingBarInner.style.width = "100%";
        loadingText.textContent = "100%";
        setTimeout(() => {
          document.getElementById('loading-bar').style.display = 'none';
          loadingText.style.display = 'none';
        }, 500); // Espera 500ms para ocultar la barra y el texto
      }
    };


    function enterFullscreen() {
      let element = document.documentElement
      if (element.requestFullscreen) {
        element.requestFullscreen();
      } else if (element.mozRequestFullScreen) { /* Firefox */
        element.mozRequestFullScreen();
      } else if (element.webkitRequestFullscreen) { /* Chrome, Safari & Opera */
        element.webkitRequestFullscreen();
      } else if (element.msRequestFullscreen) { /* IE/Edge */
        element.msRequestFullscreen();
      }
      const canvas = document.getElementById('unity-canvas');
      canvas.focus()
    }


    function lockLandscape() {
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(err => console.error("Error locking the orientation", err));
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      const canvas = document.getElementById('unity-canvas');
      const laoder = document.getElementById('loading-bar');


      function lockLandscape() {
        if (screen.orientation && screen.orientation.lock) {
          screen.orientation.lock('landscape').catch(err => console.error("Error locking the orientation", err));
        }
      }
      // Set canvas size to full screen
      canvas.style.width = '100vw';
      canvas.style.height = '100vh';
      laoder.style.width = '100vw';
      laoder.style.height = '100vh';
      enterFullscreen(); // Fullscreen the whole page
      lockLandscape(); // Lock orientation to landscape
    });

    window.addEventListener('resize', function () {
      const canvas = document.getElementById('unity-canvas');
      var image = document.getElementById('portrait-image');
      var button = document.getElementById('fullscreen-btn');
      if (window.innerHeight > window.innerWidth) {
        // Orientación portrait
        image.style.display = 'block'; // Muestra la imagen
        button.style.display = 'none'; // Muestra la imagen
      } else {
        // Orientación landscape
        image.style.display = 'none'; // Oculta la imagen
        button.style.display = 'block'; // Oculta la imagen
        enterFullscreen()
      }
    });


    document.addEventListener("fullscreenchange", () => {
      var button = document.getElementById('fullscreen-btn');

      if (document.fullscreenElement) {
      const canvas = document.getElementById('unity-canvas');
        canvas.focus()
        button.style.display = 'none'; // Oculta la imagen
      } else {
        button.style.display = 'block'; // Oculta la imagen
      }
    });

    document.addEventListener('DOMContentLoaded', () => {
      // Disparar el evento resize al cargar la página para ajustar la visibilidad inicial de la imagen
      window.dispatchEvent(new Event('resize'));
    });

    document.getElementById('fullscreen-btn').addEventListener('click', function () {
      if (screen.orientation && screen.orientation.lock) {
        screen.orientation.lock('landscape').catch(err => console.error("Error locking the orientation", err));
      }
      enterFullscreen();
    });

    createUnityInstance(document.querySelector("#unity-canvas"), {
      dataUrl: "Build/macv6.data.gz",
      frameworkUrl: "Build/macv6.framework.js.gz",
      codeUrl: "Build/macv6.wasm.gz",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "game",
      productVersion: "4.0.2",
      // matchWebGLToCanvasSize: false, // Uncomment this to separately control WebGL canvas render size and DOM element size.
      // devicePixelRatio: 1, // Uncomment this to override low DPI rendering on high DPI displays.
    });
  </script>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-P0TC5KW0YW"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag('js', new Date());

    gtag('config', 'G-P0TC5KW0YW');
  </script>
</body>

</html>